import pygame
import random
import sys
import requests
from io import BytesIO

# Fonction pour charger une image depuis une URL
def load_image_from_url(url):
    response = requests.get(url)
    img = pygame.image.load(BytesIO(response.content))
    return img

# Initialiser Pygame
pygame.init()

# Définir les dimensions de la fenêtre
width, height = 800, 600
window = pygame.display.set_mode((width, height))

# Charger les images depuis les URLs
player_image = load_image_from_url("https://3ba8d8ca06.cbaul-cdnwnd.com/ad31ff7aa5568419f0bcf71e9af28d64/200000013-dc858dc859/700/drapeau%20Danazie%20mini.webp?ph=3ba8d8ca06")
enemy_image = load_image_from_url("https://3ba8d8ca06.cbaul-cdnwnd.com/ad31ff7aa5568419f0bcf71e9af28d64/200000355-b2009b200a/IMG_0749.webp?ph=3ba8d8ca06")

# Redimensionner les images
player_image = pygame.transform.scale(player_image, (50, 50))
enemy_image = pygame.transform.scale(enemy_image, (50, 50))

# Couleurs
WHITE = (255, 255, 255)

# Vitesse initiale
player_speed = 5
enemy_speed = 2

# Position initiale du joueur et de l'ennemi
player_pos = [width // 2, height // 2]
enemy_pos = [random.randint(0, width), random.randint(0, height)]

# Score
score = 0
font = pygame.font.Font(None, 74)

# Fonction pour afficher le score
def display_score(score):
    text = font.render("Score: " + str(score), True, WHITE)
    window.blit(text, (10, 10))

# Fonction pour gérer l'écran de menu
def menu_screen(high_score):
    window.fill((0, 0, 0))
    text = font.render("Jouer", True, WHITE)
    high_score_text = font.render("Meilleur Score: " + str(high_score), True, WHITE)
    window.blit(text, (width // 2 - text.get_width() // 2, height // 2))
    window.blit(high_score_text, (width // 2 - high_score_text.get_width() // 2, height // 2 + 100))
    pygame.display.update()

    waiting = True
    while waiting:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                pygame.quit()
                sys.exit()
            if event.type == pygame.KEYDOWN and event.key == pygame.K_RETURN:
                waiting = False

# Fonction principale du jeu
def game_loop():
    global player_pos, enemy_pos, enemy_speed, score

    clock = pygame.time.Clock()
    running = True

    while running:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                pygame.quit()
                sys.exit()

        keys = pygame.key.get_pressed()
        if keys[pygame.K_LEFT]:
            player_pos[0] -= player_speed
        if keys[pygame.K_RIGHT]:
            player_pos[0] += player_speed
        if keys[pygame.K_UP]:
            player_pos[1] -= player_speed
        if keys[pygame.K_DOWN]:
            player_pos[1] += player_speed

        # Déplacer l'ennemi vers le joueur
        if enemy_pos[0] < player_pos[0]:
            enemy_pos[0] += enemy_speed
        elif enemy_pos[0] > player_pos[0]:
            enemy_pos[0] -= enemy_speed

        if enemy_pos[1] < player_pos[1]:
            enemy_pos[1] += enemy_speed
        elif enemy_pos[1] > player_pos[1]:
            enemy_pos[1] -= enemy_speed

        # Augmenter la vitesse de l'ennemi
        enemy_speed += 0.01

        # Vérifier les collisions
        if pygame.Rect(enemy_pos[0], enemy_pos[1], 50, 50).colliderect(pygame.Rect(player_pos[0], player_pos[1], 50, 50)):
            running = False

        # Mettre à jour le score
        score += 1

        # Afficher les éléments
        window.fill((0, 0, 0))
        window.blit(player_image, player_pos)
        window.blit(enemy_image, enemy_pos)
        display_score(score)
        pygame.display.update()

        clock.tick(30)

    return score

# Gérer le menu principal
high_score = 0
while True:
    menu_screen(high_score)
    score = game_loop()
    if score > high_score:
        high_score = score
